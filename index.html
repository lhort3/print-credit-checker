<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Print Credit Checker</title>
  <style>
    :root{
      --blue-900: #004aad;
      --blue-500: #3399ff;
      --blue-200: #cce0ff;
      --bg: #e0f0ff;
      --white: #ffffff;
      --red-500: #ff6666;
      --red-700: #cc3333;
      --panel-radius: 12px;
      --gap: 18px;
      --button-size: 88px;
      --font-family: "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    }

    html,body{height:100%;margin:0;font-family:var(--font-family);background:var(--bg);}

    .header{
      background:var(--blue-900);
      color:var(--white);
      display:flex;
      align-items:center;
      gap:12px;
      padding:14px 22px;
      box-shadow:0 6px 18px rgba(0,0,0,0.08);
    }
    .logo{width:44px;height:44px;border-radius:6px;overflow:hidden;display:flex;align-items:center;justify-content:center}
    .logo img{width:100%;height:100%;object-fit:contain}
    .title{font-size:20px;font-weight:700}

    .wrap{max-width:1100px;margin:30px auto;padding:18px;display:grid;grid-template-columns:420px 1fr;gap:var(--gap)}

    .left-panel{background:var(--white);border-radius:var(--panel-radius);padding:20px;box-shadow:0 6px 18px rgba(0,0,0,0.06);display:flex;flex-direction:column;align-items:center}
    .keypad{display:grid;grid-template-columns:repeat(3,1fr);gap:14px}
    .key{width:var(--button-size);height:var(--button-size);border-radius:12px;background:var(--blue-500);border:none;color:var(--white);font-size:28px;font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center;user-select:none}
    .key:hover{transform:translateY(-4px);box-shadow:0 8px 20px rgba(0,0,0,0.12)}
    .key:active{transform:translateY(0)}

    .delete{background:var(--red-500)}
    .delete:hover{background:var(--red-700)}

    .right-panel{background:var(--white);border-radius:var(--panel-radius);padding:26px;box-shadow:0 6px 18px rgba(0,0,0,0.06);display:flex;flex-direction:column;justify-content:space-between}

    .instructions{font-size:18px;color:#003165;margin-bottom:12px}
    .code-display{font-family:monospace;background:linear-gradient(90deg,var(--blue-200),#ffffff);padding:16px;border-radius:10px;display:flex;gap:12px;align-items:center}
    .digit{font-size:34px;padding:8px 14px;border-radius:8px;min-width:18px;text-align:center}

    .result{margin-top:18px;font-size:20px;min-height:68px;display:flex;flex-direction:column;gap:6px}
    .name{font-weight:700;font-size:22px;color:var(--blue-900)}
    .credit{font-size:20px;color:#1a4d86}
    .error{color:#9b1b1b;font-weight:700}

    .bottom-row{display:flex;align-items:center;justify-content:space-between;margin-top:20px;gap:12px}

    .loader-wrap{display:flex;align-items:center;gap:12px}
    .loader-svg{width:84px;height:84px}
    .loader-label{font-size:14px;color:#003165}

    .muted{color:#406081}

    @media(min-width:1200px){
      .wrap{grid-template-columns:480px 1fr}
      --button-size:96px;
    }

  </style>
</head>
<body>
  <div class="header">
    <div class="logo"><img src="https://example.com/logo.png" alt="Logo"></div>
    <div class="title">Print Credit Checker</div>
  </div>

  <div class="wrap">
    <div class="left-panel">
      <div style="margin-bottom:14px;color:#0b3266;font-weight:700">Enter your 4-digit code</div>
      <div class="keypad" id="keypad"></div>
    </div>

    <div class="right-panel">
      <div>
        <div class="instructions">Please key your 4 digit code.</div>
        <div class="code-display" id="codeDisplay" aria-live="polite"></div>
        <div class="result" id="resultArea" aria-live="polite"></div>
      </div>
      <div class="bottom-row">
        <div class="loader-wrap">
          <svg class="loader-svg" viewBox="0 0 100 100">
            <defs>
              <linearGradient id="g1" x1="0" x2="1">
                <stop offset="0%" stop-color="var(--blue-500)" />
                <stop offset="100%" stop-color="var(--blue-900)" />
              </linearGradient>
            </defs>
            <circle cx="50" cy="50" r="40" stroke="#e6f3ff" stroke-width="10" fill="none"></circle>
            <circle id="progressCircle" cx="50" cy="50" r="40" stroke="url(#g1)" stroke-width="10" fill="none" stroke-linecap="round" transform="rotate(-90 50 50)" stroke-dasharray="251.2" stroke-dashoffset="251.2"></circle>
            <text id="loaderText" x="50" y="56" font-size="18" text-anchor="middle" fill="#003165">0s</text>
          </svg>
        </div>
      </div>
    </div>
  </div>

  <script>
    const GITHUB_JSON_URL = 'https://raw.githubusercontent.com/lhort3/print-credit-checker/main/print-credits.json';
    const RESET_SECONDS = 5;

    const keypadEl = document.getElementById('keypad');
    const codeDisplay = document.getElementById('codeDisplay');
    const resultArea = document.getElementById('resultArea');
    const progressCircle = document.getElementById('progressCircle');
    const loaderText = document.getElementById('loaderText');

    let code = '';
    let countdownTimer = null;
    let countdownStart = null;
    let countdownRunning = false;

    const buttons = ['1','2','3','4','5','6','7','8','9','delete','0'];
    buttons.forEach(b => {
      const btn = document.createElement('button');
      btn.className = 'key';
      btn.type = 'button';
      btn.setAttribute('aria-label', b === 'delete' ? 'Delete' : 'Digit ' + b);
      if(b === 'delete'){
        btn.classList.add('delete');
        btn.textContent = 'Delete';
      } else {
        btn.textContent = b;
      }
      btn.addEventListener('click', () => onKeyPress(b));
      keypadEl.appendChild(btn);
    });

    renderCodeDisplay();

    function onKeyPress(key){
      if(countdownRunning) return;
      if(key === 'delete'){
        code = code.slice(0, -1);
        renderCodeDisplay();
      } else if(code.length < 4){
        code += key;
        renderCodeDisplay();
        if(code.length === 4){
          lookupCode(code);
        }
      }
    }

    function renderCodeDisplay(){
      codeDisplay.innerHTML = '';
      for(let i=0;i<4;i++){
        const d = document.createElement('div');
        d.className = 'digit';
        d.textContent = code[i] ? code[i] : '_';
        codeDisplay.appendChild(d);
      }
    }

    async function lookupCode(codeEntered){
      showMessage('Looking up...', 'muted');
      try{
        const resp = await fetch(GITHUB_JSON_URL, {cache: 'no-store'});
        if(!resp.ok) throw new Error('Failed to fetch data - status ' + resp.status);
        const data = await resp.json();
        if(data && data[codeEntered]){
          const person = data[codeEntered];
          showResult(person.name, person.credit);
        } else {
          showError('User ID not Registered');
        }
      } catch(err){
        console.error(err);
        showError('WiFi Issue');
      }
      startCountdown();
    }

    function showMessage(msg, cls){
      resultArea.innerHTML = '';
      const p = document.createElement('div');
      p.className = cls || '';
      p.textContent = msg;
      resultArea.appendChild(p);
    }

    function showResult(name, credit){
      resultArea.innerHTML = '';
      const n = document.createElement('div'); n.className = 'name'; n.textContent = name;
      const c = document.createElement('div'); c.className = 'credit'; c.textContent = 'Credit: Â£' + Number(credit).toFixed(2);
      resultArea.appendChild(n);
      resultArea.appendChild(c);
    }

    function showError(msg){
      resultArea.innerHTML = '';
      const e = document.createElement('div'); e.className = 'error'; e.textContent = msg;
      resultArea.appendChild(e);
    }

    const CIRCLE_CIRCUMFERENCE = 2 * Math.PI * 40;
    progressCircle.style.strokeDasharray = CIRCLE_CIRCUMFERENCE;
    progressCircle.style.strokeDashoffset = CIRCLE_CIRCUMFERENCE;

    function startCountdown(){
      countdownRunning = true;
      countdownStart = performance.now();
      loaderText.textContent = RESET_SECONDS + 's';
      countdownTimer = requestAnimationFrame(tick);
    }

    function tick(ts){
      const elapsed = (ts - countdownStart) / 1000;
      const remaining = Math.max(0, RESET_SECONDS - elapsed);
      const progress = remaining / RESET_SECONDS;
      progressCircle.style.strokeDashoffset = CIRCLE_CIRCUMFERENCE * progress;
      loaderText.textContent = Math.ceil(remaining) + 's';
      if(remaining <= 0){
        cancelAnimationFrame(countdownTimer);
        resetAll();
        return;
      }
      countdownTimer = requestAnimationFrame(tick);
    }

    function resetAll(){
      code = '';
      countdownRunning = false;
      progressCircle.style.strokeDashoffset = CIRCLE_CIRCUMFERENCE;
      loaderText.textContent = '0s';
      resultArea.innerHTML = '';
      renderCodeDisplay();
    }

    loaderText.textContent = '0s';

    window.addEventListener('keydown', (e) => {
      if(e.key >= '0' && e.key <= '9') onKeyPress(e.key);
      if(e.key === 'Backspace') onKeyPress('delete');
    });
  </script>
</body>
</html>
